<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Redirect Stdout to Streaming Response in Django | WANcatServer</title><meta name=keywords content="Python,Django,Threading,Tutorial"><meta name=description content="Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to redirect the stdout in our functions to the user&rsquo;s browser.
Given a function like the following. How to see the stdout in real-time in the browser?
import time def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time."><meta name=author content="wancat"><link rel=canonical href=https://wancat.cc/english/post/django-redirect-stdout-to-streaming-eng/><link href=/assets/css/stylesheet.min.0e4a1b49e740c28140e9ee4945aab2f86cb0a7bfbf5a5d612d0cb5df7d6141f4.css integrity="sha256-DkobSedAwoFA6e5JRaqy+Gywp7+/Wl1hLQy1331hQfQ=" rel="preload stylesheet" as=style><link rel=icon href=https://wancat.cc/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wancat.cc/img/logo.png><link rel=icon type=image/png sizes=32x32 href=https://wancat.cc/img/logo.png><link rel=apple-touch-icon href=https://wancat.cc/img/logo.png><link rel=mask-icon href=https://wancat.cc/img/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.74.3"><link rel=alternate hreflang=zh href=https://wancat.cc/english/post/django-redirect-stdout-to-streaming-eng/><script type=text/javascript>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function(){var u="//matomo.linchpins.cloud/";_paq.push(['setTrackerUrl',u+'matomo.php']);_paq.push(['setSiteId','3']);var d=document,g=d.createElement('script'),s=d.getElementsByTagName('script')[0];g.type='text/javascript';g.async=true;g.src=u+'matomo.js';s.parentNode.insertBefore(g,s);})();</script><meta property="og:title" content="How to Redirect Stdout to Streaming Response in Django"><meta property="og:description" content="Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to redirect the stdout in our functions to the user&rsquo;s browser.
Given a function like the following. How to see the stdout in real-time in the browser?
import time def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time."><meta property="og:type" content="article"><meta property="og:url" content="https://wancat.cc/english/post/django-redirect-stdout-to-streaming-eng/"><meta property="og:image" content="https://wancat.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:published_time" content="2021-05-25T11:28:37+08:00"><meta property="article:modified_time" content="2021-05-25T11:28:37+08:00"><meta property="og:site_name" content="WANcatServer"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wancat.cc/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How to Redirect Stdout to Streaming Response in Django"><meta name=twitter:description content="Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to redirect the stdout in our functions to the user&rsquo;s browser.
Given a function like the following. How to see the stdout in real-time in the browser?
import time def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Englishes","item":"https://wancat.cc/english/"},{"@type":"ListItem","position":3,"name":"How to Redirect Stdout to Streaming Response in Django","item":"https://wancat.cc/english/post/django-redirect-stdout-to-streaming-eng/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Redirect Stdout to Streaming Response in Django","name":"How to Redirect Stdout to Streaming Response in Django","description":"Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to …","keywords":["Python","Django","Threading","Tutorial"],"articleBody":"Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to redirect the stdout in our functions to the user’s browser.\nGiven a function like the following. How to see the stdout in real-time in the browser?\nimport time def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time.sleep(0.5) Streaming Response Normally, responses are sent after all the data has been collected. However, sometimes we can’t wait until the data is prepared. In this case, we’ll use streaming response. In Django, it’s StreamingHttpResponse. I’ll call it SHR in the following article. StreamingHttpResponse accepts an iterator for input. It sends the value each time getting a new value from the iterator. To use it, we only need to implement an iterator function. It will send the value from yield  to the user’s browser in real-time.\n# Example of StreamingHttpResponse from django.http.response import StreamingHttpResponse def example(): for i in range(5): # Add to break line in browser yield f'{i}\n' def stream(request): return StreamingHttpResponse(example()) Output (in browser):\n0 1 2 3 4 Threading As we execute the task and stream output at the same time, we need concurrence. In Python, there are multiple choices, like threading, multiprocessing, etc. I’ll use threading in this article because it is easier for me.\n# Example of threading from threading import Thread import time def example(times): for i in range(times): print(i) time.sleep(1) # Create Thread thread = Thread(target=example, args=(5,)) # Start Thread thread.start() time.sleep(2) print(\"This is printed in the main thread\") # Waiting thread to be done thread.join() Output:\n0 1 This is printed in the main thread 2 3 4 Redirect Stdout To change the location where Python print, we need to change sys. stdout. It accepts any File-like object. Specifically, we need to define an object with the write method.\n# Example of redirect stdout import sys class Printer: def __init__(self): self.contents = [] def write(self, value): self.contents.append(value) printer = Printer() sys.stdout = printer print('This should be saved in printer') sys.stdout = sys.__stdout__ print('This should be printed to stdout') print(printer.contents) Output:\nThis should be printed to stdout ['This should be saved in printer', '\\n'] Implement Redirecting Stdout to Streaming Response Environment Python 3.8.5\nDjango 3.2\nFirst, create Django Project\npip install django django-admin startproject console_streaming cd console_streaming python manage.py startapp web Install web\n# console_streaming/settings.py INSTALLED_APPS = [ ... # Add web 'web', ] Create a view\n# web/views.py def stream(request): # implement later pass Bind to URL\n# console_streaming/urls.py from django.urls import path from web import views urlpatterns = [ path('stream/', views.stream), ] Testing Task This is the testing function we’re going to use. It will repeat printing a line and waiting a second for n times, and then print “Done”.\n# web/views.py import time def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time.sleep(0.5) Printer class We implement a Printer class to handle stdout, and we’ll only use one instance in the whale program life cycle. Because sys.stdout does not thread-specific, if we use different stdout in different requests, one would grab stdout from another. So I use a dictionary to store the queue for different threads, and use current_thread() to identify and pick the right queue. If the current thread hasn’t registered to Printer, use the default stdout.\n# web/views.py from queue import Queue from threading import current_thread import sys class Printer: def __init__(self): self.queues = {} def write(self, value): '''handle stdout''' queue = self.queues.get(current_thread().name) if queue: queue.put(value) else: sys.__stdout__.write(value) def flush(self): '''Django would crash without this''' pass def register(self, thread): '''register a Thread''' queue = Queue() self.queues[thread.name] = queue return queue def clean(self, thread): '''delete a Thread''' del self.queues[thread.name] # Initialize a Printer instance printer = Printer() sys.stdout = printer Streamer class Next, we’re going to implement concurrent execution and streaming response by a Streamer class. It will initialize a thread, and register it to the printer to get a queue. Then it repeats to read the value from queue and yield to response until the thread ends.\nfrom threading import Thread class Steamer: def __init__(self, target, args): self.thread = Thread(target=target, args=args) self.queue = printer.register(self.thread) def start(self): self.thread.start() print('This should be stdout') while self.thread.is_alive(): try: item = self.queue.get_nowait() yield f'{item}\n' except Empty: pass yield 'End' printer.clean(self.thread) def stream(request): streamer = Steamer(job, (10,)) return StreamingHttpResponse(streamer.start()) Run Django server\n$ python manage.py runserver Open http://localhost:8000/stream/\nThen you can see\nEach time you make a request, you can see one output in the terminal.\nThis should be stdout Full views.py from django.http.response import StreamingHttpResponse from queue import Queue, Empty from threading import Thread, current_thread import time import sys class Printer: def __init__(self): self.queues = {} def write(self, value): '''handle stdout''' queue = self.queues.get(current_thread().name) if queue: queue.put(value) else: sys.__stdout__.write(value) def flush(self): '''Django would crash without this''' pass def register(self, thread): '''register a Thread''' queue = Queue() self.queues[thread.name] = queue return queue def clean(self, thread): '''delete a Thread''' del self.queues[thread.name] printer = Printer() sys.stdout = printer class Steamer: def __init__(self, target, args): self.thread = Thread(target=target, args=args) self.queue = printer.register(self.thread) def start(self): self.thread.start() print('This should be stdout') while self.thread.is_alive(): try: item = self.queue.get_nowait() yield f'{item}\n' except Empty: pass yield 'End' printer.clean(self.thread) def job(times): for i in range(times): print(f'Task #{i}') time.sleep(1) print('Done') time.sleep(0.5) def stream(request): streamer = Steamer(job, (10,)) return StreamingHttpResponse(streamer.start()) Complete code on GitHub\nReferences  Python Docs: threading Python Docs: queue Chase Seibert: Redirect console output to a Django HttpResponse thread specific sys.stdout? G. T. Wang: Python 多執行緒 threading 模組平行化程式設計教學  ","wordCount":"917","inLanguage":"zh","datePublished":"2021-05-25T11:28:37+08:00","dateModified":"2021-05-25T11:28:37+08:00","author":{"@type":"Person","name":"wancat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wancat.cc/english/post/django-redirect-stdout-to-streaming-eng/"},"publisher":{"@type":"Organization","name":"WANcatServer","logo":{"@type":"ImageObject","url":"https://wancat.cc/img/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://wancat.cc accesskey=h title="WANcatServer (Alt + H)"><img src=/img/logo.png alt=logo aria-label=logo height=35>WANcatServer</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://wancat.cc/en/ title=En aria-label=En>En</a></li></ul></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://wancat.cc/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://wancat.cc/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://wancat.cc/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://wancat.cc/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://wancat.cc/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>How to Redirect Stdout to Streaming Response in Django</h1><div class=post-meta>May 25, 2021&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;wancat</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目录</div></summary><div class=inner><ul><li><a href=#streaming-response aria-label="Streaming Response">Streaming Response</a></li><li><a href=#threading aria-label=Threading>Threading</a></li><li><a href=#redirect-stdout aria-label="Redirect Stdout">Redirect Stdout</a></li><li><a href=#implement-redirecting-stdout-to-streaming-response aria-label="Implement Redirecting Stdout to Streaming Response">Implement Redirecting Stdout to Streaming Response</a><ul><li><a href=#environment aria-label=Environment>Environment</a></li><li><a href=#testing-task aria-label="Testing Task">Testing Task</a></li><li><a href=#printer-class aria-label="Printer class">Printer class</a></li><li><a href=#streamer-class aria-label="Streamer class">Streamer class</a></li></ul></li><li><a href=#full-viewspy aria-label="Full views.py">Full views.py</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><p>Sometimes we need to execute some long tasks at the backend, and the tasks are complicated and error-prone. So we hope users can see the real-time console log. Thus we need to redirect the stdout in our functions to the user&rsquo;s browser.</p><p>Given a function like the following. How to see the stdout in real-time in the browser?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> time


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>job</span>(times):
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(times):
        <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#39;Task #{i}&#39;</span>)
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Done&#39;</span>)
    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.5</span>)
</code></pre></div><p><img loading=lazy src=output.gif alt></p><h2 id=streaming-response>Streaming Response<a hidden class=anchor aria-hidden=true href=#streaming-response>#</a></h2><p>Normally, responses are sent after all the data has been collected. However, sometimes we can&rsquo;t wait until the data is prepared. In this case, we&rsquo;ll use <strong>streaming response</strong>. In Django, it&rsquo;s StreamingHttpResponse. I&rsquo;ll call it SHR in the following article. StreamingHttpResponse accepts an iterator for input. It sends the value each time getting a new value from the iterator. To use it, we only need to implement an iterator function. It will send the value from <code>yield</code> to the user&rsquo;s browser in real-time.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Example of StreamingHttpResponse</span>

<span style=color:#f92672>from</span> django.http.response <span style=color:#f92672>import</span> StreamingHttpResponse
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>example</span>():
	<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>5</span>):
        <span style=color:#75715e># Add &lt;br&gt; to break line in browser</span>
		<span style=color:#66d9ef>yield</span> f<span style=color:#e6db74>&#39;{i}&lt;br&gt;&#39;</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stream</span>(request):
    <span style=color:#66d9ef>return</span> StreamingHttpResponse(example())

</code></pre></div><p>Output (in browser):</p><pre><code>0
1
2
3
4
</code></pre><h2 id=threading>Threading<a hidden class=anchor aria-hidden=true href=#threading>#</a></h2><p>As we execute the task and stream output at the same time, we need <strong>concurrence</strong>. In Python, there are multiple choices, like threading, multiprocessing, etc. I&rsquo;ll use threading in this article because it is easier for me.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Example of threading</span>

<span style=color:#f92672>from</span> threading <span style=color:#f92672>import</span> Thread
<span style=color:#f92672>import</span> time

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>example</span>(times):
	<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(times):
		<span style=color:#66d9ef>print</span>(i)
		time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)

<span style=color:#75715e># Create Thread</span>
thread <span style=color:#f92672>=</span> Thread(target<span style=color:#f92672>=</span>example, args<span style=color:#f92672>=</span>(<span style=color:#ae81ff>5</span>,))

<span style=color:#75715e># Start Thread</span>
thread<span style=color:#f92672>.</span>start()

time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>2</span>)
<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#34;This is printed in the main thread&#34;</span>)

<span style=color:#75715e># Waiting thread to be done</span>
thread<span style=color:#f92672>.</span>join()
</code></pre></div><p>Output:</p><pre><code>0
1
This is printed in the main thread
2
3
4
</code></pre><h2 id=redirect-stdout>Redirect Stdout<a hidden class=anchor aria-hidden=true href=#redirect-stdout>#</a></h2><p>To change the location where Python print, we need to change <code>sys. stdout</code>. It accepts any File-like object. Specifically, we need to define an object with the <code>write</code> method.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Example of redirect stdout</span>
<span style=color:#f92672>import</span> sys

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Printer</span>:
    <span style=color:#66d9ef>def</span> __init__(self):
        self<span style=color:#f92672>.</span>contents <span style=color:#f92672>=</span> []

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write</span>(self, value):
        self<span style=color:#f92672>.</span>contents<span style=color:#f92672>.</span>append(value)

printer <span style=color:#f92672>=</span> Printer()
sys<span style=color:#f92672>.</span>stdout <span style=color:#f92672>=</span> printer

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;This should be saved in printer&#39;</span>)

sys<span style=color:#f92672>.</span>stdout <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>__stdout__

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;This should be printed to stdout&#39;</span>)

<span style=color:#66d9ef>print</span>(printer<span style=color:#f92672>.</span>contents)
</code></pre></div><p>Output:</p><pre><code>This should be printed to stdout
['This should be saved in printer', '\n']
</code></pre><h2 id=implement-redirecting-stdout-to-streaming-response>Implement Redirecting Stdout to Streaming Response<a hidden class=anchor aria-hidden=true href=#implement-redirecting-stdout-to-streaming-response>#</a></h2><h3 id=environment>Environment<a hidden class=anchor aria-hidden=true href=#environment>#</a></h3><p>Python 3.8.5</p><p>Django 3.2</p><p>First, create Django Project</p><pre><code>pip install django
django-admin startproject console_streaming
cd console_streaming
python manage.py startapp web
</code></pre><p>Install web</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># console_streaming/settings.py</span>

INSTALLED_APPS <span style=color:#f92672>=</span> [
	<span style=color:#f92672>...</span>
    <span style=color:#75715e># Add web</span>
    <span style=color:#e6db74>&#39;web&#39;</span>,
]
</code></pre></div><p>Create a view</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># web/views.py</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stream</span>(request):
    <span style=color:#75715e># implement later</span>
    <span style=color:#66d9ef>pass</span>
</code></pre></div><p>Bind to URL</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># console_streaming/urls.py</span>

<span style=color:#f92672>from</span> django.urls <span style=color:#f92672>import</span> path
<span style=color:#f92672>from</span> web <span style=color:#f92672>import</span> views

urlpatterns <span style=color:#f92672>=</span> [
    path(<span style=color:#e6db74>&#39;stream/&#39;</span>, views<span style=color:#f92672>.</span>stream),
]
</code></pre></div><h3 id=testing-task>Testing Task<a hidden class=anchor aria-hidden=true href=#testing-task>#</a></h3><p>This is the testing function we&rsquo;re going to use. It will repeat printing a line and waiting a second for n times, and then print &ldquo;Done&rdquo;.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># web/views.py</span>
<span style=color:#f92672>import</span> time


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>job</span>(times):
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(times):
        <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#39;Task #{i}&#39;</span>)
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Done&#39;</span>)
    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.5</span>)
</code></pre></div><h3 id=printer-class>Printer class<a hidden class=anchor aria-hidden=true href=#printer-class>#</a></h3><p>We implement a Printer class to handle stdout, and we&rsquo;ll only use <strong>one instance</strong> in the whale program life cycle. Because <code>sys.stdout</code> does not thread-specific, if we use different stdout in different requests, one would grab stdout from another. So I use a dictionary to store the queue for different threads, and use <code>current_thread()</code> to identify and pick the right queue. If the current thread hasn&rsquo;t registered to Printer, use the default stdout.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># web/views.py</span>
<span style=color:#f92672>from</span> queue <span style=color:#f92672>import</span> Queue
<span style=color:#f92672>from</span> threading <span style=color:#f92672>import</span> current_thread
<span style=color:#f92672>import</span> sys


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Printer</span>:
    <span style=color:#66d9ef>def</span> __init__(self):
        self<span style=color:#f92672>.</span>queues <span style=color:#f92672>=</span> {}

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write</span>(self, value):
        <span style=color:#e6db74>&#39;&#39;&#39;handle stdout&#39;&#39;&#39;</span>
        queue <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>queues<span style=color:#f92672>.</span>get(current_thread()<span style=color:#f92672>.</span>name)
        <span style=color:#66d9ef>if</span> queue:
            queue<span style=color:#f92672>.</span>put(value)
        <span style=color:#66d9ef>else</span>:
            sys<span style=color:#f92672>.</span>__stdout__<span style=color:#f92672>.</span>write(value)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>flush</span>(self):
        <span style=color:#e6db74>&#39;&#39;&#39;Django would crash without this&#39;&#39;&#39;</span>
        <span style=color:#66d9ef>pass</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>register</span>(self, thread):
        <span style=color:#e6db74>&#39;&#39;&#39;register a Thread&#39;&#39;&#39;</span>
        queue <span style=color:#f92672>=</span> Queue()
        self<span style=color:#f92672>.</span>queues[thread<span style=color:#f92672>.</span>name] <span style=color:#f92672>=</span> queue
        <span style=color:#66d9ef>return</span> queue

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clean</span>(self, thread):
        <span style=color:#e6db74>&#39;&#39;&#39;delete a Thread&#39;&#39;&#39;</span>
        <span style=color:#66d9ef>del</span> self<span style=color:#f92672>.</span>queues[thread<span style=color:#f92672>.</span>name]
        
<span style=color:#75715e># Initialize a Printer instance</span>
printer <span style=color:#f92672>=</span> Printer()
sys<span style=color:#f92672>.</span>stdout <span style=color:#f92672>=</span> printer
</code></pre></div><h3 id=streamer-class>Streamer class<a hidden class=anchor aria-hidden=true href=#streamer-class>#</a></h3><p>Next, we&rsquo;re going to implement concurrent execution and streaming response by a Streamer class. It will initialize a thread, and register it to the printer to get a queue. Then it repeats to read the value from queue and yield to response until the thread ends.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> threading <span style=color:#f92672>import</span> Thread


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Steamer</span>:
    <span style=color:#66d9ef>def</span> __init__(self, target, args):
        self<span style=color:#f92672>.</span>thread <span style=color:#f92672>=</span> Thread(target<span style=color:#f92672>=</span>target, args<span style=color:#f92672>=</span>args)
        self<span style=color:#f92672>.</span>queue <span style=color:#f92672>=</span> printer<span style=color:#f92672>.</span>register(self<span style=color:#f92672>.</span>thread)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(self):
        self<span style=color:#f92672>.</span>thread<span style=color:#f92672>.</span>start()
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;This should be stdout&#39;</span>)
        <span style=color:#66d9ef>while</span> self<span style=color:#f92672>.</span>thread<span style=color:#f92672>.</span>is_alive():
            <span style=color:#66d9ef>try</span>:
                item <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>queue<span style=color:#f92672>.</span>get_nowait()
                <span style=color:#66d9ef>yield</span> f<span style=color:#e6db74>&#39;{item}&lt;br&gt;&#39;</span>
            <span style=color:#66d9ef>except</span> Empty:
                <span style=color:#66d9ef>pass</span>
        <span style=color:#66d9ef>yield</span> <span style=color:#e6db74>&#39;End&#39;</span>
        printer<span style=color:#f92672>.</span>clean(self<span style=color:#f92672>.</span>thread)

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stream</span>(request):
    streamer <span style=color:#f92672>=</span> Steamer(job, (<span style=color:#ae81ff>10</span>,))
    <span style=color:#66d9ef>return</span> StreamingHttpResponse(streamer<span style=color:#f92672>.</span>start())
</code></pre></div><p>Run Django server</p><pre><code>$ python manage.py runserver
</code></pre><p>Open http://localhost:8000/stream/</p><p>Then you can see</p><p><img loading=lazy src=output.gif alt></p><p>Each time you make a request, you can see one output in the terminal.</p><pre><code>This should be stdout
</code></pre><h2 id=full-viewspy>Full views.py<a hidden class=anchor aria-hidden=true href=#full-viewspy>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> django.http.response <span style=color:#f92672>import</span> StreamingHttpResponse
<span style=color:#f92672>from</span> queue <span style=color:#f92672>import</span> Queue, Empty
<span style=color:#f92672>from</span> threading <span style=color:#f92672>import</span> Thread, current_thread
<span style=color:#f92672>import</span> time
<span style=color:#f92672>import</span> sys


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Printer</span>:
    <span style=color:#66d9ef>def</span> __init__(self):
        self<span style=color:#f92672>.</span>queues <span style=color:#f92672>=</span> {}

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write</span>(self, value):
        <span style=color:#e6db74>&#39;&#39;&#39;handle stdout&#39;&#39;&#39;</span>
        queue <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>queues<span style=color:#f92672>.</span>get(current_thread()<span style=color:#f92672>.</span>name)
        <span style=color:#66d9ef>if</span> queue:
            queue<span style=color:#f92672>.</span>put(value)
        <span style=color:#66d9ef>else</span>:
            sys<span style=color:#f92672>.</span>__stdout__<span style=color:#f92672>.</span>write(value)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>flush</span>(self):
        <span style=color:#e6db74>&#39;&#39;&#39;Django would crash without this&#39;&#39;&#39;</span>
        <span style=color:#66d9ef>pass</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>register</span>(self, thread):
        <span style=color:#e6db74>&#39;&#39;&#39;register a Thread&#39;&#39;&#39;</span>
        queue <span style=color:#f92672>=</span> Queue()
        self<span style=color:#f92672>.</span>queues[thread<span style=color:#f92672>.</span>name] <span style=color:#f92672>=</span> queue
        <span style=color:#66d9ef>return</span> queue

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>clean</span>(self, thread):
        <span style=color:#e6db74>&#39;&#39;&#39;delete a Thread&#39;&#39;&#39;</span>
        <span style=color:#66d9ef>del</span> self<span style=color:#f92672>.</span>queues[thread<span style=color:#f92672>.</span>name]


printer <span style=color:#f92672>=</span> Printer()
sys<span style=color:#f92672>.</span>stdout <span style=color:#f92672>=</span> printer


<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Steamer</span>:
    <span style=color:#66d9ef>def</span> __init__(self, target, args):
        self<span style=color:#f92672>.</span>thread <span style=color:#f92672>=</span> Thread(target<span style=color:#f92672>=</span>target, args<span style=color:#f92672>=</span>args)
        self<span style=color:#f92672>.</span>queue <span style=color:#f92672>=</span> printer<span style=color:#f92672>.</span>register(self<span style=color:#f92672>.</span>thread)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(self):
        self<span style=color:#f92672>.</span>thread<span style=color:#f92672>.</span>start()
        <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;This should be stdout&#39;</span>)
        <span style=color:#66d9ef>while</span> self<span style=color:#f92672>.</span>thread<span style=color:#f92672>.</span>is_alive():
            <span style=color:#66d9ef>try</span>:
                item <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>queue<span style=color:#f92672>.</span>get_nowait()
                <span style=color:#66d9ef>yield</span> f<span style=color:#e6db74>&#39;{item}&lt;br&gt;&#39;</span>
            <span style=color:#66d9ef>except</span> Empty:
                <span style=color:#66d9ef>pass</span>
        <span style=color:#66d9ef>yield</span> <span style=color:#e6db74>&#39;End&#39;</span>
        printer<span style=color:#f92672>.</span>clean(self<span style=color:#f92672>.</span>thread)


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>job</span>(times):
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(times):
        <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#39;Task #{i}&#39;</span>)
        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Done&#39;</span>)
    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>0.5</span>)


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stream</span>(request):
    streamer <span style=color:#f92672>=</span> Steamer(job, (<span style=color:#ae81ff>10</span>,))
    <span style=color:#66d9ef>return</span> StreamingHttpResponse(streamer<span style=color:#f92672>.</span>start())

</code></pre></div><p>Complete code on <a href=https://github.com/lancatlin/python_console_streaming>GitHub</a></p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://docs.python.org/3/library/threading.html#thread-objects>Python Docs: threading</a></li><li><a href=https://docs.python.org/3/library/queue.html#queue-objects>Python Docs: queue</a></li><li><a href=https://chase-seibert.github.io/blog/2010/08/06/redirect-console-output-to-a-django-httpresponse.html>Chase Seibert: Redirect console output to a Django HttpResponse</a></li><li><a href=https://bytes.com/topic/python/answers/36067-thread-specific-sys-stdout>thread specific sys.stdout?</a></li><li><a href=https://blog.gtwang.org/programming/python-threading-multithreaded-programming-tutorial/>G. T. Wang: Python 多執行緒 threading 模組平行化程式設計教學</a></li></ul></div><iframe class=LikeCoin height=235 src="https://button.like.co/in/embed/wancatserver/button?referrer=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f" width=100% frameborder=0></iframe>
<a rel=license href=http://creativecommons.org/licenses/by-sa/3.0/tw/><img alt="創用 CC 授權條款" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/3.0/tw/88x31.png></a>
本著作係採用<a rel=license href=http://creativecommons.org/licenses/by-sa/3.0/tw/>創用 CC 姓名標示-相同方式分享 3.0 台灣 授權條款</a>授權.<footer class=post-footer><ul class=post-tags><li><a href=https://wancat.cc/tags/python/>Python</a></li><li><a href=https://wancat.cc/tags/django/>Django</a></li><li><a href=https://wancat.cc/tags/threading/>Threading</a></li><li><a href=https://wancat.cc/tags/tutorial/>Tutorial</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on twitter" href="https://twitter.com/intent/tweet/?text=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django&url=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f&hashtags=Python%2cDjango%2cThreading%2cTutorial"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f&title=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django&summary=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django&source=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f&title=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on whatsapp" href="https://api.whatsapp.com/send?text=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django%20-%20https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share How to Redirect Stdout to Streaming Response in Django on telegram" href="https://telegram.me/share/url?text=How%20to%20Redirect%20Stdout%20to%20Streaming%20Response%20in%20Django&url=https%3a%2f%2fwancat.cc%2fenglish%2fpost%2fdjango-redirect-stdout-to-streaming-eng%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://wancat.cc>WANcatServer</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>